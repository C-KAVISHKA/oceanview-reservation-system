<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - OceanView Resort</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="page-login">
    <!-- Animated ocean waves background -->
    <div class="ocean-bg">
        <div class="wave wave1"></div>
        <div class="wave wave2"></div>
        <div class="wave wave3"></div>
    </div>

    <!-- Floating particles -->
    <div class="particle" style="width: 6px; height: 6px; left: 8%; top: 20%; animation-delay: 0s;"></div>
    <div class="particle" style="width: 4px; height: 4px; left: 15%; top: 60%; animation-delay: 1.5s;"></div>
    <div class="particle" style="width: 8px; height: 8px; left: 30%; top: 35%; animation-delay: 3s;"></div>
    <div class="particle" style="width: 5px; height: 5px; left: 45%; top: 75%; animation-delay: 0.5s;"></div>
    <div class="particle" style="width: 7px; height: 7px; left: 60%; top: 15%; animation-delay: 2s;"></div>
    <div class="particle" style="width: 4px; height: 4px; left: 75%; top: 50%; animation-delay: 4s;"></div>
    <div class="particle" style="width: 6px; height: 6px; left: 88%; top: 30%; animation-delay: 1s;"></div>
    <div class="particle" style="width: 5px; height: 5px; left: 92%; top: 70%; animation-delay: 2.5s;"></div>

    <div class="container">
        <div class="login-container">
            <!-- Decorative top accent -->
            <div class="login-accent"></div>
            
            <div class="login-brand">
                <div class="brand-logo-wrap">
                    <span class="brand-logo-icon">ðŸŒŠ</span>
                </div>
                <h1>OceanView Resort</h1>
                <p class="brand-tagline">Staff Portal</p>
            </div>
            
            <form id="loginForm" autocomplete="on">
                <div class="form-group">
                    <label for="email">
                        <span class="label-icon">ðŸ“§</span> Email Address
                    </label>
                    <div class="input-wrapper">
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            required 
                            placeholder="staff@oceanview.com"
                            autocomplete="email">
                        <span class="input-icon-right">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M22 7l-10 7L2 7"/></svg>
                        </span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="password">
                        <span class="label-icon">ðŸ”’</span> Password
                    </label>
                    <div class="input-wrapper">
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            required 
                            placeholder="Enter your password"
                            autocomplete="current-password">
                        <button type="button" class="toggle-password" id="togglePassword" title="Show password" aria-label="Toggle password visibility">
                            <svg id="eyeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            <svg id="eyeOffIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
                                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                                <line x1="1" y1="1" x2="23" y2="23"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="form-extras">
                    <label class="remember-me">
                        <input type="checkbox" id="rememberMe">
                        <span class="checkmark"></span>
                        Remember me
                    </label>
                    <a href="#" class="forgot-link" onclick="event.preventDefault(); alert('Please contact your administrator to reset your password.');">Forgot password?</a>
                </div>
                
                <div id="errorMessage" class="error-message" style="display: none;"></div>
                
                <button type="submit" class="btn btn-login" id="loginBtn">
                    <span class="btn-text">Sign In</span>
                    <span class="btn-loader" style="display: none;">
                        <span class="spinner-sm"></span> Signing in...
                    </span>
                    <span class="btn-arrow">&rarr;</span>
                </button>
            </form>
            
            <div class="login-divider">
                <span>Demo Access</span>
            </div>

            <div class="demo-info">
                <div class="demo-row">
                    <span class="demo-label">Email</span>
                    <span class="demo-value" id="demoEmail" onclick="copyDemo('email')">staff@oceanview.com <span class="copy-hint">click to fill</span></span>
                </div>
                <div class="demo-row">
                    <span class="demo-label">Password</span>
                    <span class="demo-value" id="demoPassword" onclick="copyDemo('password')">Passw0rd! <span class="copy-hint">click to fill</span></span>
                </div>
            </div>

            <div class="login-footer">
                <p>&copy; 2026 OceanView Resort, Galle</p>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
        // Password visibility toggle
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');
        const eyeIcon = document.getElementById('eyeIcon');
        const eyeOffIcon = document.getElementById('eyeOffIcon');

        togglePassword.addEventListener('click', function() {
            const isPassword = passwordInput.type === 'password';
            passwordInput.type = isPassword ? 'text' : 'password';
            eyeIcon.style.display = isPassword ? 'none' : 'block';
            eyeOffIcon.style.display = isPassword ? 'block' : 'none';
            this.title = isPassword ? 'Hide password' : 'Show password';
            this.classList.add('toggled');
            setTimeout(() => this.classList.remove('toggled'), 200);
        });

        // Demo credential fill
        function copyDemo(field) {
            if (field === 'email') {
                document.getElementById('email').value = 'staff@oceanview.com';
                document.getElementById('demoEmail').classList.add('copied');
                setTimeout(() => document.getElementById('demoEmail').classList.remove('copied'), 600);
            } else {
                document.getElementById('password').value = 'Passw0rd!';
                document.getElementById('demoPassword').classList.add('copied');
                setTimeout(() => document.getElementById('demoPassword').classList.remove('copied'), 600);
            }
        }

        // Login form
        const loginForm = document.getElementById('loginForm');
        const emailInput = document.getElementById('email');
        const errorMessage = document.getElementById('errorMessage');
        const loginBtn = document.getElementById('loginBtn');

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            errorMessage.classList.add('shake');
            setTimeout(() => errorMessage.classList.remove('shake'), 500);
        }

        function hideError() {
            errorMessage.style.display = 'none';
            errorMessage.textContent = '';
        }

        function setLoading(loading) {
            loginBtn.disabled = loading;
            loginBtn.querySelector('.btn-text').style.display = loading ? 'none' : 'inline';
            loginBtn.querySelector('.btn-arrow').style.display = loading ? 'none' : 'inline';
            loginBtn.querySelector('.btn-loader').style.display = loading ? 'inline-flex' : 'none';
        }

        async function handleLogin(event) {
            event.preventDefault();
            hideError();
            
            const email = emailInput.value.trim();
            const password = passwordInput.value;
            
            if (!email || !password) {
                showError('Please enter both email and password');
                return;
            }
            
            try {
                setLoading(true);
                
                const response = await API.post('/auth/login', {
                    email: email,
                    password: password
                });
                
                if (response.token) {
                    sessionStorage.setItem('authToken', response.token);
                }
                if (response.user) {
                    sessionStorage.setItem('userEmail', response.user.email);
                    sessionStorage.setItem('userRole', response.user.role);
                    sessionStorage.setItem('userName', response.user.name);
                }
                
                if (document.getElementById('rememberMe').checked) {
                    localStorage.setItem('rememberedEmail', email);
                } else {
                    localStorage.removeItem('rememberedEmail');
                }
                
                document.querySelector('.login-container').classList.add('login-success');
                setTimeout(() => { window.location.href = 'dashboard.html'; }, 500);
                
            } catch (error) {
                console.error('Login error:', error);
                setLoading(false);
                
                if (error.status === 401) {
                    showError('Invalid email or password. Please try again.');
                } else if (error.message) {
                    showError(error.message);
                } else {
                    showError('Login failed. Please try again later.');
                }
            }
        }

        loginForm.addEventListener('submit', handleLogin);

        // Restore remembered email
        const remembered = localStorage.getItem('rememberedEmail');
        if (remembered) {
            emailInput.value = remembered;
            document.getElementById('rememberMe').checked = true;
            passwordInput.focus();
        }

        if (sessionStorage.getItem('authToken')) {
            window.location.href = 'dashboard.html';
        }

        // Input focus animation
        document.querySelectorAll('.input-wrapper input').forEach(input => {
            input.addEventListener('focus', () => input.closest('.input-wrapper').classList.add('focused'));
            input.addEventListener('blur', () => input.closest('.input-wrapper').classList.remove('focused'));
        });
    </script>
</body>
</html>

